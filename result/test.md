python main.py --train config/wikimovie.yml
use_kb: False
use_doc: True

training ...
loading document from datasets/wikimovie/full/documents.json
79728it [00:41, 1929.10it/s]
indexing documents ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79728/79728 [00:15<00:00, 4998.20it/s]
loading data from datasets/wikimovie/full/train.json
96180it [00:54, 1761.79it/s]
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 96180/96180 [00:33<00:00, 2879.86it/s]
avg local entity:  247.00319193179456
max_local_entity 641
preparing data ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 96180/96180 [00:46<00:00, 2078.37it/s]
loading data from datasets/wikimovie/full/dev.json
10000it [00:04, 2370.96it/s]
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [00:03<00:00, 2836.21it/s]
avg local entity:  246.0746
max_local_entity 552
preparing data ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [00:04<00:00, 2054.21it/s]
loading data from datasets/wikimovie/full/test.json
9952it [00:10, 967.16it/s] 
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9952/9952 [00:03<00:00, 2882.73it/s]
avg local entity:  246.8485731511254
max_local_entity 555
preparing data ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9952/9952 [00:04<00:00, 2092.11it/s]
epoch 0
  0%|                                                                                                                                                                       | 0/1202 [00:00<?, ?it/s]main.py:65: UserWarning: torch.nn.utils.clip_grad_norm is now deprecated in favor of torch.nn.utils.clip_grad_norm_.
  torch.nn.utils.clip_grad_norm(my_model.parameters(), cfg['gradient_clip'])
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [41:53<00:00,  2.09s/it]
avg_training_loss tensor(0.0150, device='cuda:0')
max_training_acc 0.9788997504159679
avg_training_acc 0.2623544093178033
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:39<00:00,  2.28it/s]
avg_loss tensor(0.0075, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.5801999999999999
saving model to model/wikimovie_test/best_model_doc
epoch 1
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:39<00:00,  1.98s/it]
avg_training_loss tensor(0.0061, device='cuda:0')
max_training_acc 0.9788997504159676
avg_training_acc 0.617439683860233
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:44<00:00,  2.23it/s]
avg_loss tensor(0.0060, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.7060999999999998
saving model to model/wikimovie_test/best_model_doc
epoch 2
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:39<00:00,  1.98s/it]
avg_training_loss tensor(0.0050, device='cuda:0')
max_training_acc 0.9788893510815253
avg_training_acc 0.7112000831946759
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:46<00:00,  2.21it/s]
avg_loss tensor(0.0051, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.763799999999999
saving model to model/wikimovie_test/best_model_doc
epoch 3
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:26<00:00,  1.97s/it]
avg_training_loss tensor(0.0044, device='cuda:0')
max_training_acc 0.9788893510815251
avg_training_acc 0.7767782861896835
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:40<00:00,  2.27it/s]
avg_loss tensor(0.0045, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8098999999999998
saving model to model/wikimovie_test/best_model_doc
epoch 4
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:31<00:00,  1.97s/it]
avg_training_loss tensor(0.0039, device='cuda:0')
max_training_acc 0.978889351081524
avg_training_acc 0.8139767054908489
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:40<00:00,  2.27it/s]
avg_loss tensor(0.0041, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8313999999999996
saving model to model/wikimovie_test/best_model_doc
epoch 5
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:24<00:00,  1.97s/it]
avg_training_loss tensor(0.0036, device='cuda:0')
max_training_acc 0.9788997504159673
avg_training_acc 0.8338810316139764
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:40<00:00,  2.27it/s]
avg_loss tensor(0.0040, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8376
saving model to model/wikimovie_test/best_model_doc
epoch 6
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:25<00:00,  1.97s/it]
avg_training_loss tensor(0.0033, device='cuda:0')
max_training_acc 0.9788893510815275
avg_training_acc 0.8445715474209651
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:40<00:00,  2.27it/s]
avg_loss tensor(0.0040, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8439999999999988
saving model to model/wikimovie_test/best_model_doc
epoch 7
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:31<00:00,  1.97s/it]
avg_training_loss tensor(0.0033, device='cuda:0')
max_training_acc 0.9788997504159681
avg_training_acc 0.8502807820299494
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:45<00:00,  2.22it/s]
avg_loss tensor(0.0038, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8483999999999996
saving model to model/wikimovie_test/best_model_doc
epoch 8
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [40:06<00:00,  2.00s/it]
avg_training_loss tensor(0.0031, device='cuda:0')
max_training_acc 0.9788893510815259
avg_training_acc 0.8578514975041593
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:44<00:00,  2.23it/s]
avg_loss tensor(0.0037, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8523999999999982
saving model to model/wikimovie_test/best_model_doc
epoch 9
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [39:29<00:00,  1.97s/it]
avg_training_loss tensor(0.0029, device='cuda:0')
max_training_acc 0.978889351081525
avg_training_acc 0.8630823627287844
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:40<00:00,  2.27it/s]
avg_loss tensor(0.0037, device='cuda:0')
max_acc 0.9786999999999977
avg_acc 0.8516999999999981
evaluating on test
loading model from ... model/wikimovie_test/best_model_doc
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 497/497 [03:53<00:00,  2.13it/s]
avg_loss tensor(0.0038, device='cuda:0')
max_acc 0.9801810865191124
avg_acc 0.8542253521126759

use_kb: False
use_doc: True

use_kb: True
use_doc: True
/workspace/dialogSystem/GraftNet/util.py:15: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  config = yaml.load(setting)
training ...
loading document from datasets/wikimovie/full/documents.json
79728it [00:40, 1984.66it/s]
indexing documents ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79728/79728 [00:15<00:00, 5090.61it/s]
loading data from datasets/wikimovie/full/train.json
96180it [00:54, 1751.58it/s]
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 96180/96180 [00:36<00:00, 2621.47it/s]
avg local entity:  283.26668746101063
max_local_entity 650
preparing data ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 96180/96180 [01:33<00:00, 1027.57it/s]
loading data from datasets/wikimovie/full/dev.json
10000it [00:04, 2363.27it/s]
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [00:03<00:00, 2561.60it/s]
avg local entity:  282.4321
max_local_entity 592
preparing data ...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [00:09<00:00, 1060.10it/s]
loading data from datasets/wikimovie/full/test.json
9952it [00:12, 805.89it/s] 
max_relevant_doc:  100
max_facts:  400
building word index ...
converting global to local entity index ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9952/9952 [00:03<00:00, 2553.16it/s]
avg local entity:  283.079481511254
max_local_entity 595
preparing data ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9952/9952 [00:09<00:00, 1059.87it/s]
epoch 0
  0%|                                                                                                                                                                       | 0/1202 [00:00<?, ?it/s]main.py:65: UserWarning: torch.nn.utils.clip_grad_norm is now deprecated in favor of torch.nn.utils.clip_grad_norm_.
  torch.nn.utils.clip_grad_norm(my_model.parameters(), cfg['gradient_clip'])
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:46<00:00,  2.19s/it]
avg_training_loss tensor(0.0066, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.8650582362728771
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:00<00:00,  2.08it/s]
avg_loss tensor(0.0006, device='cuda:0')
max_acc 0.9995
avg_acc 0.9696999999999973
saving model to model/wikimovie_test/best_model_kb
epoch 1
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:44<00:00,  2.18s/it]
avg_training_loss tensor(0.0005, device='cuda:0')
max_training_acc 0.9996048252911804
avg_training_acc 0.9683964226289501
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:00<00:00,  2.08it/s]
avg_loss tensor(0.0005, device='cuda:0')
max_acc 0.9995
avg_acc 0.9711999999999974
saving model to model/wikimovie_test/best_model_kb
epoch 2
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:45<00:00,  2.18s/it]
avg_training_loss tensor(0.0004, device='cuda:0')
max_training_acc 0.9996048252911809
avg_training_acc 0.9680844425956737
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:06<00:00,  2.03it/s]
avg_loss tensor(0.0005, device='cuda:0')
max_acc 0.9995
avg_acc 0.9694999999999971
epoch 3
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:45<00:00,  2.18s/it]
avg_training_loss tensor(0.0004, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.9685732113144734
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:02<00:00,  2.06it/s]
avg_loss tensor(0.0004, device='cuda:0')
max_acc 0.9995
avg_acc 0.9695999999999972
epoch 4
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:45<00:00,  2.18s/it]
avg_training_loss tensor(0.0004, device='cuda:0')
max_training_acc 0.9996048252911809
avg_training_acc 0.9692387687187978
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:00<00:00,  2.08it/s]
avg_loss tensor(0.0004, device='cuda:0')
max_acc 0.9995
avg_acc 0.968499999999997
epoch 5
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:46<00:00,  2.18s/it]
avg_training_loss tensor(0.0003, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.9689683860232917
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [03:59<00:00,  2.09it/s]
avg_loss tensor(0.0004, device='cuda:0')
max_acc 0.9995
avg_acc 0.9701999999999973
epoch 6
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:46<00:00,  2.18s/it]
avg_training_loss tensor(0.0004, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.9696651414309471
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:01<00:00,  2.07it/s]
avg_loss tensor(0.0005, device='cuda:0')
max_acc 0.9995
avg_acc 0.9689999999999972
epoch 7
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:45<00:00,  2.18s/it]
avg_training_loss tensor(0.0003, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.9693531613976686
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:05<00:00,  2.04it/s]
avg_loss tensor(0.0004, device='cuda:0')
max_acc 0.9995
avg_acc 0.9703999999999974
epoch 8
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:45<00:00,  2.18s/it]
avg_training_loss tensor(0.0003, device='cuda:0')
max_training_acc 0.9996048252911804
avg_training_acc 0.9702579034941748
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:03<00:00,  2.05it/s]
avg_loss tensor(0.0005, device='cuda:0')
max_acc 0.9995
avg_acc 0.9710999999999971
epoch 9
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1202/1202 [43:44<00:00,  2.18s/it]
avg_training_loss tensor(0.0003, device='cuda:0')
max_training_acc 0.9996048252911807
avg_training_acc 0.9701019134775355
validating ...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 500/500 [04:02<00:00,  2.06it/s]
avg_loss tensor(0.0004, device='cuda:0')
max_acc 0.9995
avg_acc 0.9714999999999975
saving model to model/wikimovie_test/best_model_kb
evaluating on test
loading model from ... model/wikimovie_test/best_model_kb
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 497/497 [04:13<00:00,  1.96it/s]
avg_loss tensor(0.0003, device='cuda:0')
max_acc 0.9998993963782696
avg_acc 0.9692152917504998